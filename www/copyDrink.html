<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">

    <script src="components/loader.js"></script>
    <script src="lib/onsenui/js/onsenui.min.js"></script>

    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="lib/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="lib/onsenui/css/onsen-css-components.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic&display=swap" rel="stylesheet">
    <script>
        // APIキーの設定とSDK初期化
        var ncmb = new NCMB("a59165a217e09aae15a26c95a9e51f8510ea7fbb8da9ad8c15686fa1c5b449e7", "32551b9f4f6afa631f1fc4b63df334ab33683be35b820813931f0e6c156aa4c3");

        var reader = new FileReader();
        reader.onload = function(e) {
            var dataUrl = reader.result;
            document.getElementById("image").src = dataUrl;
        }

        // 処理を一時停止する
        const wait = (sec) => { // タイマ
            return new Promise((resolve, reject) => {
                setTimeout(resolve, sec * 1000);
            });
        };

        // 画像を配置する
        function setImage(i, flg) {
            reader.onload = function(e) {
                var dataUrl = reader.result;
                if (flg == 0) {
                    console.log("flg_g");
                    image_id = "g_image" + (i + 1);
                }
                console.log(image_id);
                document.getElementById(image_id).src = dataUrl;
            }
        }

        // 画像を読み込む
        function downloadImage(fileName) {
            // ダウンロード（データ形式をblobを指定）
            ncmb.File.download(fileName, "blob")
                .then(function(blob) {
                    // ファイルリーダーにデータを渡す
                    reader.readAsDataURL(blob);
                })
                .catch(function(err) {
                    console.error(err);
                })
        }

        // サムネイル画像を上から順に表示する
        async function setImg(flg) {
            // 一覧画面(リロード)
            for (var j = g_imgs.length - g_cntSwitch - (cnt * 4); j > g_imgs.length - 4 * (cnt + 1); j--) {
                if (j <= -1) {
                    break;
                }
                console.log("ダウンロードする画像の位置 " + j);
                downloadImage(g_imgs[j]);
                await wait(0.1);
                setImage(j, flg);
                await wait(1.5);
            }
        }

        // 取得した情報で画面を上書き
        function drink() {
            var Drink = ncmb.DataStore("drink");
            Drink.fetchAll()
                .then(function(results) {
                    for (var i = 0; i <= results.length - 1; i++) {
                        var object = results[i];
                        var img = object.img;
                        var a = ;
                        //ボイスをリストに格納
                        var drinklist_element = document.getElementById('drinklist');
                        drinklist_element.insertAdjacentHTML("beforebegin", object.drinkName + '<br><img src="" id="image" width="110" height="150"/>' +
                            '<script>downloadImage()</script>');
                    }
                    document.getElementById('drinkName').innerHTML = object.drinkName;
                    document.getElementById('imgame').innerHTML = document;
                }).catch(function(err) {
                    console.log(err);
                });
        }

        function downloadImage(img) { // ファイル名からファイルを取得 console.log(img);
            var fileName = img; // TODO // ダウンロード（データ形式をblobを指定） ncmb.File.download(fileName) .then(function() { // ファイルリーダーにデータを渡す console.log(reader.readAsDataURL()) return reader.readAsDataURL(); }) .catch(function(err) { return "取得できてない"; }) }
    </script>

</head>

<body id="prodact_lists" onload="drink()">

    <!-- お気に入りボイス -->
    <br>
    <ul class="next-voice-list" id="drinklist">
    </ul>

</body>

</html>